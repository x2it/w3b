<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹åŠ¨ç‰ˆ é“¾æ¥è®¿é—®å·¥å…·ï¼ˆä»…æ˜¾ç¤ºé€‰ä¸­èŒƒå›´é“¾æ¥ï¼‰</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        body {
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }
        .controls {
            margin-bottom: 20px;
        }
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        button.stop {
            background: #dc3545;
        }
        button.secondary {
            background: #6c757d;
        }
        button.success {
            background: #28a745;
        }
        .progress {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .link-list {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 4px;
        }
        .link-item {
            padding: 12px 15px;
            margin: 0;
            border-bottom: 1px solid #e9ecef;
            border-left: 4px solid #6c757d;
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .link-item:last-child {
            border-bottom: none;
        }
        /* æœªç‚¹å‡»çŠ¶æ€ */
        .link-item.pending {
            border-left-color: #6c757d;
            background: #f8f9fa;
        }
        /* å·²ç‚¹å‡»çŠ¶æ€ */
        .link-item.clicked {
            border-left-color: #28a745;
            background: #f0fff4;
        }
        /* å½“å‰é€‰ä¸­/å¾…ç‚¹å‡»çŠ¶æ€ */
        .link-item.current {
            border-left-color: #17a2b8;
            background: #e8f4f8;
            font-weight: bold;
        }
        .warning {
            color: #ffc107;
            background: #fff8e1;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .import-section, .range-section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .file-input-wrapper, .range-input-wrapper {
            margin: 10px 0;
        }
        #linkTextarea {
            width: 100%;
            height: 120px;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            resize: vertical;
            margin: 10px 0;
            font-family: monospace;
        }
        .import-info, .range-info {
            color: #6c757d;
            font-size: 14px;
            margin-top: 5px;
        }
        .link-info {
            flex: 1;
        }
        .link-actions {
            margin-left: 15px;
        }
        .open-btn {
            padding: 6px 12px;
            font-size: 14px;
            background: #28a745;
        }
        .open-btn:disabled {
            background: #6c757d;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .stat-item {
            padding: 8px 12px;
            background: #e9ecef;
            border-radius: 4px;
        }
        .stat-number {
            font-weight: bold;
            color: #007bff;
        }
        .clicked-number {
            color: #28a745;
        }
        .range-input-wrapper input {
            width: 80px;
            padding: 8px;
            margin: 0 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ‰‹åŠ¨ç‰ˆ é“¾æ¥è®¿é—®å·¥å…·ï¼ˆä»…æ˜¾ç¤ºé€‰ä¸­èŒƒå›´é“¾æ¥ï¼‰</h1>
        
        <div class="warning">
            âš ï¸ æ³¨æ„ï¼šç‚¹å‡»"æ‰“å¼€é“¾æ¥"æŒ‰é’®ä¼šåœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€é“¾æ¥ï¼Œç‚¹å‡»åä¼šæ ‡è®°ä¸ºå·²è®¿é—®çŠ¶æ€ï¼
        </div>

        <!-- å¯¼å…¥é“¾æ¥åŒºåŸŸ -->
        <div class="import-section">
            <h3 style="margin-bottom: 10px;">é“¾æ¥å¯¼å…¥/ç¼–è¾‘</h3>
            <div class="file-input-wrapper">
                <input type="file" id="linkFileInput" accept=".txt" style="margin-right: 10px;">
                <button id="importBtn" class="secondary">å¯¼å…¥æ–‡æœ¬æ–‡ä»¶</button>
                <button id="saveBtn" class="success">ä¿å­˜å½“å‰é“¾æ¥</button>
                <button id="clearBtn" class="stop">æ¸…ç©ºé“¾æ¥åº“</button>
            </div>
            <p class="import-info">ğŸ“ æ–‡æœ¬æ–‡ä»¶è¦æ±‚ï¼šæ¯è¡Œä¸€ä¸ªé“¾æ¥ï¼›ä¹Ÿå¯ç›´æ¥åœ¨ä¸‹æ–¹æ–‡æœ¬æ¡†ç¼–è¾‘é“¾æ¥</p>
            <textarea id="linkTextarea" placeholder="è¯·è¾“å…¥é“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ª..."></textarea>
            <button id="applyTextBtn">åº”ç”¨æ–‡æœ¬æ¡†ä¸­çš„é“¾æ¥</button>
        </div>

        <!-- èŒƒå›´é€‰æ‹©åŒºåŸŸ -->
        <div class="range-section">
            <h3 style="margin-bottom: 10px;">é“¾æ¥èŒƒå›´é€‰æ‹©</h3>
            <div class="range-input-wrapper">
                <label>é€‰æ‹©èŒƒå›´ï¼š</label>
                ä» <input type="number" id="startRangeInput" value="1" min="1" disabled> 
                åˆ° <input type="number" id="endRangeInput" value="1" min="1" disabled>
                <button id="applyRangeBtn" disabled>åº”ç”¨èŒƒå›´</button>
                <button id="resetRangeBtn" disabled>é‡ç½®èŒƒå›´ï¼ˆæ˜¾ç¤ºå…¨éƒ¨ï¼‰</button>
            </div>
            <p class="range-info">ğŸ“Œ åº”ç”¨èŒƒå›´åï¼Œä»…æ˜¾ç¤ºå’Œæ“ä½œæŒ‡å®šèŒƒå›´å†…çš„é“¾æ¥</p>
        </div>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="stats">
            <div class="stat-item">æ€»é“¾æ¥æ•°ï¼š<span id="totalCount" class="stat-number">0</span></div>
            <div class="stat-item">å½“å‰æ˜¾ç¤ºæ•°ï¼š<span id="rangeCount" class="stat-number">0</span></div>
            <div class="stat-item">å·²ç‚¹å‡»æ•°ï¼š<span id="clickedCount" class="stat-number clicked-number">0</span></div>
            <div class="stat-item">æœªç‚¹å‡»æ•°ï¼š<span id="pendingCount" class="stat-number">0</span></div>
            <div class="stat-item">å®Œæˆç‡ï¼š<span id="completionRate" class="stat-number">0%</span></div>
        </div>

        <div class="controls">
            <button id="resetBtn">é‡ç½®æ‰€æœ‰ç‚¹å‡»çŠ¶æ€</button>
            <button id="openNextBtn" disabled>æ‰“å¼€ä¸‹ä¸€ä¸ªæœªç‚¹å‡»é“¾æ¥</button>
        </div>

        <div class="progress">
            <p>å½“å‰çŠ¶æ€ï¼š<span id="statusText">æœªå¯¼å…¥é“¾æ¥</span></p>
        </div>

        <!-- é“¾æ¥åˆ—è¡¨ -->
        <div class="link-list" id="linkListContainer">
            <!-- é“¾æ¥åˆ—è¡¨ä¼šåœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            <div style="padding: 20px; text-align: center; color: #6c757d;">
                è¯·å…ˆå¯¼å…¥æˆ–è¾“å…¥é“¾æ¥
            </div>
        </div>
    </div>

    <script>
        // ========== å…¨å±€å˜é‡ ==========
        let LINK_LIBRARY = [];      // å®Œæ•´é“¾æ¥åº“
        let clickStatus = [];       // ç‚¹å‡»çŠ¶æ€æ•°ç»„ (true=å·²ç‚¹å‡», false=æœªç‚¹å‡»)
        let currentIndex = 0;       // å½“å‰å¾…ç‚¹å‡»çš„é“¾æ¥ç´¢å¼•
        // èŒƒå›´é€‰æ‹©å˜é‡
        let rangeStart = 1;         // èŒƒå›´èµ·å§‹ç¼–å·
        let rangeEnd = 1;           // èŒƒå›´ç»“æŸç¼–å·
        let isRangeActive = false;  // æ˜¯å¦å¯ç”¨èŒƒå›´ç­›é€‰

        // DOM å…ƒç´ 
        const linkFileInput = document.getElementById('linkFileInput');
        const importBtn = document.getElementById('importBtn');
        const saveBtn = document.getElementById('saveBtn');
        const clearBtn = document.getElementById('clearBtn');
        const linkTextarea = document.getElementById('linkTextarea');
        const applyTextBtn = document.getElementById('applyTextBtn');
        const resetBtn = document.getElementById('resetBtn');
        const openNextBtn = document.getElementById('openNextBtn');
        const linkListContainer = document.getElementById('linkListContainer');
        const statusText = document.getElementById('statusText');
        // èŒƒå›´é€‰æ‹©å…ƒç´ 
        const startRangeInput = document.getElementById('startRangeInput');
        const endRangeInput = document.getElementById('endRangeInput');
        const applyRangeBtn = document.getElementById('applyRangeBtn');
        const resetRangeBtn = document.getElementById('resetRangeBtn');
        // ç»Ÿè®¡å…ƒç´ 
        const totalCount = document.getElementById('totalCount');
        const rangeCount = document.getElementById('rangeCount');
        const clickedCount = document.getElementById('clickedCount');
        const pendingCount = document.getElementById('pendingCount');
        const completionRate = document.getElementById('completionRate');

        // ========== æ ¸å¿ƒå·¥å…·å‡½æ•° ==========
        // è·å–å½“å‰èŒƒå›´å†…çš„é“¾æ¥ç´¢å¼•åˆ—è¡¨
        function getCurrentRangeIndexes() {
            if (!isRangeActive || LINK_LIBRARY.length === 0) {
                // æœªå¯ç”¨èŒƒå›´ï¼Œè¿”å›æ‰€æœ‰ç´¢å¼•
                return Array.from({ length: LINK_LIBRARY.length }, (_, i) => i);
            }
            // å¯ç”¨èŒƒå›´ï¼Œè¿”å›æŒ‡å®šåŒºé—´çš„ç´¢å¼•ï¼ˆç¼–å·è½¬ç´¢å¼•ï¼šç¼–å·-1ï¼‰
            const startIdx = rangeStart - 1;
            const endIdx = rangeEnd - 1;
            return Array.from({ length: endIdx - startIdx + 1 }, (_, i) => startIdx + i);
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼ˆä»…ç»Ÿè®¡å½“å‰æ˜¾ç¤ºçš„é“¾æ¥ï¼‰
        function updateStats() {
            const total = LINK_LIBRARY.length;
            // è·å–å½“å‰æ˜¾ç¤ºçš„é“¾æ¥ç´¢å¼•
            const currentRangeIndexes = getCurrentRangeIndexes();
            const displayTotal = currentRangeIndexes.length;
            
            // è®¡ç®—å½“å‰æ˜¾ç¤ºèŒƒå›´å†…çš„å·²ç‚¹å‡»æ•°
            const clicked = currentRangeIndexes.filter(idx => clickStatus[idx]).length;
            const pending = displayTotal - clicked;
            const rate = displayTotal > 0 ? Math.round((clicked / displayTotal) * 100) : 0;

            // æ›´æ–°æ˜¾ç¤º
            totalCount.textContent = total;
            rangeCount.textContent = displayTotal;
            clickedCount.textContent = clicked;
            pendingCount.textContent = pending;
            completionRate.textContent = `${rate}%`;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            openNextBtn.disabled = pending === 0;
            applyRangeBtn.disabled = total === 0;
            resetRangeBtn.disabled = !isRangeActive;
            startRangeInput.disabled = total === 0;
            endRangeInput.disabled = total === 0;
            
            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
            if (total === 0) {
                statusText.textContent = 'æœªå¯¼å…¥é“¾æ¥';
            } else if (isRangeActive) {
                if (pending === 0) {
                    statusText.textContent = `èŒƒå›´ ${rangeStart}-${rangeEnd} å†…æ‰€æœ‰é“¾æ¥å·²ç‚¹å‡»å®Œæˆï¼ˆå…±${displayTotal}ä¸ªï¼‰`;
                } else {
                    statusText.textContent = `èŒƒå›´ ${rangeStart}-${rangeEnd} å†…è¿˜æœ‰${pending}ä¸ªé“¾æ¥æœªç‚¹å‡»`;
                }
            } else {
                if (pending === 0) {
                    statusText.textContent = `æ‰€æœ‰é“¾æ¥å·²ç‚¹å‡»å®Œæˆï¼ˆå…±${total}ä¸ªï¼‰`;
                } else {
                    statusText.textContent = `è¿˜æœ‰${pending}ä¸ªé“¾æ¥æœªç‚¹å‡»ï¼Œç‚¹å‡»"æ‰“å¼€ä¸‹ä¸€ä¸ª"ç»§ç»­`;
                }
            }
        }

        // æ¸²æŸ“é“¾æ¥åˆ—è¡¨ï¼ˆä»…æ¸²æŸ“å½“å‰èŒƒå›´å†…çš„é“¾æ¥ï¼‰
        function renderLinkList() {
            linkListContainer.innerHTML = '';
            
            // å¦‚æœæ²¡æœ‰é“¾æ¥ï¼Œæ˜¾ç¤ºæç¤º
            if (LINK_LIBRARY.length === 0) {
                linkListContainer.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: #6c757d;">
                        è¯·å…ˆå¯¼å…¥æˆ–è¾“å…¥é“¾æ¥
                    </div>
                `;
                updateStats();
                return;
            }

            // è·å–å½“å‰éœ€è¦æ˜¾ç¤ºçš„é“¾æ¥ç´¢å¼•
            const currentRangeIndexes = getCurrentRangeIndexes();

            // å¦‚æœå½“å‰èŒƒå›´æ— é“¾æ¥ï¼Œæ˜¾ç¤ºæç¤º
            if (currentRangeIndexes.length === 0) {
                linkListContainer.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: #6c757d;">
                        å½“å‰é€‰æ‹©çš„èŒƒå›´ ${rangeStart}-${rangeEnd} å†…æ— é“¾æ¥
                    </div>
                `;
                updateStats();
                return;
            }

            // ç”Ÿæˆå½“å‰èŒƒå›´å†…çš„é“¾æ¥åˆ—è¡¨
            currentRangeIndexes.forEach((index) => {
                const link = LINK_LIBRARY[index];
                const linkNumber = index + 1;
                const isClicked = clickStatus[index];
                
                // è®¾ç½®é“¾æ¥é¡¹çš„æ ·å¼ç±»
                let itemClass = 'link-item ';
                if (isClicked) {
                    itemClass += 'clicked';
                } else if (index === currentIndex) {
                    itemClass += 'current';
                } else {
                    itemClass += 'pending';
                }

                const linkItem = document.createElement('div');
                linkItem.className = itemClass;
                linkItem.id = `link-${index}`;
                linkItem.innerHTML = `
                    <div class="link-info">
                        <strong>é“¾æ¥ ${linkNumber}ï¼š</strong> 
                        <a href="${link}" target="_blank" style="word-break: break-all;">${link}</a>
                        <br>
                        <small style="color: #6c757d; margin-top: 4px; display: block;">
                            çŠ¶æ€ï¼š${isClicked ? 'âœ… å·²ç‚¹å‡»' : 'â³ æœªç‚¹å‡»'}
                        </small>
                    </div>
                    <div class="link-actions">
                        <button class="open-btn" id="open-${index}" ${isClicked ? 'disabled' : ''}>
                            ${isClicked ? 'å·²æ‰“å¼€' : 'æ‰“å¼€é“¾æ¥'}
                        </button>
                    </div>
                `;
                linkListContainer.appendChild(linkItem);

                // ç»‘å®šæ‰“å¼€é“¾æ¥æŒ‰é’®äº‹ä»¶
                const openBtn = document.getElementById(`open-${index}`);
                openBtn.addEventListener('click', () => openLink(index));
            });

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats();
        }

        // æ‰“å¼€æŒ‡å®šç´¢å¼•çš„é“¾æ¥
        function openLink(index) {
            if (index >= LINK_LIBRARY.length || clickStatus[index]) return;

            const link = LINK_LIBRARY[index];
            const linkNumber = index + 1;

            // åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€é“¾æ¥
            window.open(link, '_blank');

            // æ›´æ–°ç‚¹å‡»çŠ¶æ€
            clickStatus[index] = true;

            // æ›´æ–°å½“å‰é“¾æ¥é¡¹çš„æ ·å¼å’ŒæŒ‰é’®çŠ¶æ€
            const linkItem = document.getElementById(`link-${index}`);
            if (linkItem) { // ä»…å½“é“¾æ¥åœ¨å½“å‰æ˜¾ç¤ºèŒƒå›´å†…æ—¶æ›´æ–°
                const openBtn = document.getElementById(`open-${index}`);
                
                linkItem.classList.remove('pending', 'current');
                linkItem.classList.add('clicked');
                openBtn.disabled = true;
                openBtn.textContent = 'å·²æ‰“å¼€';
                
                // æ›´æ–°çŠ¶æ€æ–‡æœ¬
                linkItem.querySelector('small').textContent = `çŠ¶æ€ï¼šâœ… å·²ç‚¹å‡»`;
            }

            // æŸ¥æ‰¾å½“å‰èŒƒå›´å†…ä¸‹ä¸€ä¸ªæœªç‚¹å‡»çš„é“¾æ¥
            const currentRangeIndexes = getCurrentRangeIndexes();
            const nextIndex = currentRangeIndexes.find(idx => !clickStatus[idx]);
            currentIndex = nextIndex !== undefined ? nextIndex : currentIndex;
            
            // é«˜äº®ä¸‹ä¸€ä¸ªæœªç‚¹å‡»çš„é“¾æ¥ï¼ˆå…ˆæ¸…é™¤æ‰€æœ‰é«˜äº®ï¼‰
            document.querySelectorAll('.link-item.current').forEach(el => {
                el.classList.remove('current');
            });
            // é«˜äº®æ–°çš„å½“å‰é“¾æ¥ï¼ˆä»…å½“åœ¨æ˜¾ç¤ºèŒƒå›´å†…ï¼‰
            if (currentIndex !== undefined) {
                const nextLinkItem = document.getElementById(`link-${currentIndex}`);
                if (nextLinkItem) {
                    nextLinkItem.classList.add('current');
                }
            }

            // æ›´æ–°ç»Ÿè®¡å’ŒçŠ¶æ€æç¤º
            updateStats();
            statusText.textContent = `å·²æ‰“å¼€é“¾æ¥ ${linkNumber}ï¼š${link}`;
        }

        // æ‰“å¼€ä¸‹ä¸€ä¸ªæœªç‚¹å‡»çš„é“¾æ¥
        function openNextLink() {
            // æ‰¾åˆ°å½“å‰èŒƒå›´å†…ç¬¬ä¸€ä¸ªæœªç‚¹å‡»çš„é“¾æ¥
            const currentRangeIndexes = getCurrentRangeIndexes();
            const nextIndex = currentRangeIndexes.find(idx => !clickStatus[idx]);
            
            if (nextIndex === undefined) {
                alert(isRangeActive ? 'èŒƒå›´å†…æ‰€æœ‰é“¾æ¥éƒ½å·²ç‚¹å‡»å®Œæˆï¼' : 'æ‰€æœ‰é“¾æ¥éƒ½å·²ç‚¹å‡»å®Œæˆï¼');
                openNextBtn.disabled = true;
                return;
            }

            openLink(nextIndex);
        }

        // é‡ç½®æ‰€æœ‰ç‚¹å‡»çŠ¶æ€
        function resetClickStatus() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰é“¾æ¥çš„ç‚¹å‡»çŠ¶æ€å—ï¼Ÿ')) {
                clickStatus = new Array(LINK_LIBRARY.length).fill(false);
                currentIndex = getCurrentRangeIndexes()[0] || 0;
                renderLinkList();
                statusText.textContent = isRangeActive ? 
                    `å·²é‡ç½®èŒƒå›´å†…é“¾æ¥çš„ç‚¹å‡»çŠ¶æ€` : `å·²é‡ç½®æ‰€æœ‰é“¾æ¥çš„ç‚¹å‡»çŠ¶æ€`;
            }
        }

        // åº”ç”¨èŒƒå›´é€‰æ‹©ï¼ˆæ ¸å¿ƒä¿®æ”¹ï¼šä»…æ˜¾ç¤ºé€‰ä¸­èŒƒå›´ï¼‰
        function applyRange() {
            const newStart = parseInt(startRangeInput.value);
            const newEnd = parseInt(endRangeInput.value);
            const totalLinks = LINK_LIBRARY.length;

            // éªŒè¯è¾“å…¥åˆæ³•æ€§
            if (newStart < 1 || newStart > totalLinks) {
                alert(`èµ·å§‹ç¼–å·å¿…é¡»åœ¨ 1-${totalLinks} ä¹‹é—´ï¼`);
                startRangeInput.value = rangeStart;
                return;
            }
            if (newEnd < 1 || newEnd > totalLinks) {
                alert(`ç»“æŸç¼–å·å¿…é¡»åœ¨ 1-${totalLinks} ä¹‹é—´ï¼`);
                endRangeInput.value = rangeEnd;
                return;
            }
            if (newStart > newEnd) {
                alert('èµ·å§‹ç¼–å·ä¸èƒ½å¤§äºç»“æŸç¼–å·ï¼');
                return;
            }

            // æ›´æ–°èŒƒå›´å˜é‡
            rangeStart = newStart;
            rangeEnd = newEnd;
            isRangeActive = true;
            // è®¾ç½®å½“å‰ç´¢å¼•ä¸ºèŒƒå›´ç¬¬ä¸€ä¸ªé“¾æ¥
            currentIndex = rangeStart - 1;

            // é‡æ–°æ¸²æŸ“ä»…å½“å‰èŒƒå›´çš„é“¾æ¥åˆ—è¡¨
            renderLinkList();
            statusText.textContent = `å·²åº”ç”¨èŒƒå›´ï¼š${rangeStart}-${rangeEnd}ï¼ˆå…±${rangeEnd - rangeStart + 1}ä¸ªé“¾æ¥ï¼‰`;
        }

        // é‡ç½®èŒƒå›´é€‰æ‹©ï¼ˆæ˜¾ç¤ºå…¨éƒ¨ï¼‰
        function resetRange() {
            rangeStart = 1;
            rangeEnd = LINK_LIBRARY.length;
            isRangeActive = false;
            startRangeInput.value = 1;
            endRangeInput.value = LINK_LIBRARY.length;
            currentIndex = 0;

            // é‡æ–°æ¸²æŸ“å…¨éƒ¨é“¾æ¥
            renderLinkList();
            statusText.textContent = `å·²é‡ç½®èŒƒå›´ï¼Œæ˜¾ç¤ºæ‰€æœ‰ ${LINK_LIBRARY.length} ä¸ªé“¾æ¥`;
        }

        // ========== å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ ==========
        function importLinkFile() {
            const file = linkFileInput.files[0];
            if (!file) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼');
                return;
            }

            if (file.type !== 'text/plain' && !file.name.endsWith('.txt')) {
                alert('è¯·é€‰æ‹© .txt æ ¼å¼çš„æ–‡æœ¬æ–‡ä»¶ï¼');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const links = content.split('\n')
                        .map(link => link.trim())
                        .filter(link => link && link.length > 0);
                    
                    if (links.length === 0) {
                        alert('æ–‡ä»¶ä¸­æœªæ‰¾åˆ°æœ‰æ•ˆé“¾æ¥ï¼');
                        return;
                    }

                    // é‡ç½®æ‰€æœ‰çŠ¶æ€
                    LINK_LIBRARY = links;
                    clickStatus = new Array(links.length).fill(false);
                    rangeStart = 1;
                    rangeEnd = links.length;
                    isRangeActive = false;
                    currentIndex = 0;

                    // æ›´æ–°èŒƒå›´è¾“å…¥æ¡†
                    startRangeInput.max = links.length;
                    endRangeInput.max = links.length;
                    startRangeInput.value = 1;
                    endRangeInput.value = links.length;

                    // æ›´æ–°æ–‡æœ¬æ¡†å¹¶æ¸²æŸ“åˆ—è¡¨
                    linkTextarea.value = links.join('\n');
                    renderLinkList();
                    alert(`æˆåŠŸå¯¼å…¥ ${links.length} ä¸ªé“¾æ¥ï¼`);
                } catch (error) {
                    alert(`å¯¼å…¥å¤±è´¥ï¼š${error.message}`);
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        function applyTextareaLinks() {
            const text = linkTextarea.value.trim();
            if (!text) {
                // æ¸…ç©ºé“¾æ¥åº“
                LINK_LIBRARY = [];
                clickStatus = [];
                rangeStart = 1;
                rangeEnd = 1;
                isRangeActive = false;
                currentIndex = 0;
                startRangeInput.value = 1;
                endRangeInput.value = 1;
                renderLinkList();
                alert('å·²æ¸…ç©ºé“¾æ¥åº“ï¼');
                return;
            }

            // è§£ææ–‡æœ¬æ¡†ä¸­çš„é“¾æ¥
            const links = text.split('\n')
                .map(link => link.trim())
                .filter(link => link && link.length > 0);
            
            // é‡ç½®çŠ¶æ€
            LINK_LIBRARY = links;
            clickStatus = new Array(links.length).fill(false);
            rangeStart = 1;
            rangeEnd = links.length;
            isRangeActive = false;
            currentIndex = 0;

            // æ›´æ–°èŒƒå›´è¾“å…¥æ¡†
            startRangeInput.max = links.length;
            endRangeInput.max = links.length;
            startRangeInput.value = 1;
            endRangeInput.value = links.length;

            // æ¸²æŸ“åˆ—è¡¨
            renderLinkList();
            alert(`æˆåŠŸåº”ç”¨ ${links.length} ä¸ªé“¾æ¥ï¼`);
        }

        function saveLinksToFile() {
            if (LINK_LIBRARY.length === 0) {
                alert('é“¾æ¥åº“ä¸ºç©ºï¼Œæ— å†…å®¹å¯ä¿å­˜ï¼');
                return;
            }

            const content = LINK_LIBRARY.join('\n');
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `é“¾æ¥åº“_${new Date().toLocaleString().replace(/[/:\s]/g, '-')}.txt`;
            a.click();
            URL.revokeObjectURL(a.href);
        }

        function clearLinkLibrary() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºé“¾æ¥åº“å—ï¼Ÿ')) {
                LINK_LIBRARY = [];
                clickStatus = [];
                rangeStart = 1;
                rangeEnd = 1;
                isRangeActive = false;
                currentIndex = 0;
                startRangeInput.value = 1;
                endRangeInput.value = 1;
                renderLinkList();
                alert('é“¾æ¥åº“å·²æ¸…ç©ºï¼');
            }
        }

        // ========== äº‹ä»¶ç»‘å®š ==========
        resetBtn.addEventListener('click', resetClickStatus);
        openNextBtn.addEventListener('click', openNextLink);
        applyRangeBtn.addEventListener('click', applyRange);
        resetRangeBtn.addEventListener('click', resetRange);
        importBtn.addEventListener('click', importLinkFile);
        saveBtn.addEventListener('click', saveLinksToFile);
        clearBtn.addEventListener('click', clearLinkLibrary);
        applyTextBtn.addEventListener('click', applyTextareaLinks);

        // é¡µé¢åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            renderLinkList();
        });
    </script>
</body>
</html>
