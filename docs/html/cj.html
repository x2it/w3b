<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·é“¾æ¥çˆ¬è™«å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .input-section, .output-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: monospace;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(108, 117, 125, 0.3);
        }
        
        .results {
            margin-top: 20px;
        }
        
        .result-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            word-break: break-all;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .result-count {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #333;
            font-weight: 600;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #28a745;
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(150%);
            transition: transform 0.3s;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: #dc3545;
        }
        
        .progress-bar {
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
        }
        
        .buttons-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”— ç”¨æˆ·é“¾æ¥çˆ¬è™«å·¥å…·</h1>
            <p>ä»ç½‘é¡µä¸­æå–ç¬¦åˆç­›é€‰æ¡ä»¶çš„ç”¨æˆ·é“¾æ¥ï¼Œå¹¶å¯¼å‡ºä¸ºExcelæ–‡æ¡£</p>
        </div>
        
        <div class="main-content">
            <div class="input-section">
                <h2>ğŸ”§ çˆ¬è™«è®¾ç½®</h2>
                
                <div class="form-group">
                    <label for="url">ç›®æ ‡ç½‘é¡µURLï¼š</label>
                    <input type="url" id="url" placeholder="https://example.com/users" value="https://github.com/search?q=python&type=users">
                </div>
                
                <div class="form-group">
                    <label>é“¾æ¥ç­›é€‰æ¡ä»¶ï¼š</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="filter-user" checked>
                            <label for="filter-user">åŒ…å« "user"</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="filter-profile" checked>
                            <label for="filter-profile">åŒ…å« "profile"</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="filter-member">
                            <label for="filter-member">åŒ…å« "member"</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="filter-account">
                            <label for="filter-account">åŒ…å« "account"</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="custom-filter">è‡ªå®šä¹‰å…³é”®è¯ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ï¼š</label>
                    <input type="text" id="custom-filter" placeholder="ä¾‹å¦‚: user, profile, account">
                </div>
                
                <div class="form-group">
                    <label for="max-results">æœ€å¤§é“¾æ¥æ•°é‡ï¼š</label>
                    <input type="number" id="max-results" value="100" min="1" max="1000">
                </div>
                
                <div class="buttons-row">
                    <button class="btn" onclick="startCrawling()">ğŸš€ å¼€å§‹çˆ¬å–</button>
                    <button class="btn btn-secondary" onclick="resetForm()">ğŸ”„ é‡ç½®</button>
                </div>
                
                <div class="progress-bar">
                    <div class="progress" id="progress"></div>
                </div>
                
                <div class="loading" id="loading">
                    <div class="loading-spinner"></div>
                    <p>æ­£åœ¨çˆ¬å–æ•°æ®ä¸­ï¼Œè¯·ç¨å€™...</p>
                </div>
            </div>
            
            <div class="output-section">
                <h2>ğŸ“Š ç»“æœå±•ç¤º</h2>
                
                <div class="result-count" id="result-count">
                    æ‰¾åˆ° 0 ä¸ªç”¨æˆ·é“¾æ¥
                </div>
                
                <div class="results" id="results">
                    <!-- ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
                
                <div class="buttons-row">
                    <button class="btn" onclick="exportToExcel()" id="export-btn" disabled>ğŸ“¥ å¯¼å‡ºä¸ºExcel</button>
                    <button class="btn btn-secondary" onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">æ“ä½œæˆåŠŸï¼</div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let collectedLinks = [];
        
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification' + (isError ? ' error' : '');
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        function updateProgress(percentage) {
            document.getElementById('progress').style.width = percentage + '%';
        }
        
        function resetForm() {
            document.getElementById('url').value = 'https://github.com/search?q=python&type=users';
            document.getElementById('custom-filter').value = '';
            document.getElementById('max-results').value = '100';
            clearResults();
            updateProgress(0);
            showNotification('è¡¨å•å·²é‡ç½®');
        }
        
        function clearResults() {
            collectedLinks = [];
            document.getElementById('results').innerHTML = '';
            document.getElementById('result-count').textContent = 'æ‰¾åˆ° 0 ä¸ªç”¨æˆ·é“¾æ¥';
            document.getElementById('export-btn').disabled = true;
        }
        
        async function startCrawling() {
            const url = document.getElementById('url').value;
            const maxResults = parseInt(document.getElementById('max-results').value);
            
            if (!url) {
                showNotification('è¯·è¾“å…¥ç›®æ ‡URL', true);
                return;
            }
            
            // æ”¶é›†ç­›é€‰æ¡ä»¶
            const filters = [];
            if (document.getElementById('filter-user').checked) filters.push('user');
            if (document.getElementById('filter-profile').checked) filters.push('profile');
            if (document.getElementById('filter-member').checked) filters.push('member');
            if (document.getElementById('filter-account').checked) filters.push('account');
            
            const customFilter = document.getElementById('custom-filter').value;
            if (customFilter) {
                customFilter.split(',').forEach(item => {
                    const trimmed = item.trim();
                    if (trimmed) filters.push(trimmed.toLowerCase());
                });
            }
            
            if (filters.length === 0) {
                showNotification('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªç­›é€‰æ¡ä»¶', true);
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            document.getElementById('loading').style.display = 'block';
            updateProgress(10);
            
            try {
                // æ³¨æ„ï¼šç”±äºæµè§ˆå™¨çš„CORSé™åˆ¶ï¼Œè¿™é‡Œåªèƒ½çˆ¬å–å…è®¸è·¨åŸŸè®¿é—®çš„ç½‘ç«™
                // å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½éœ€è¦ä¸€ä¸ªåç«¯ä»£ç†
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
                updateProgress(40);
                
                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                }
                
                const data = await response.json();
                updateProgress(70);
                
                // è§£æHTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(data.contents, 'text/html');
                
                // æå–æ‰€æœ‰é“¾æ¥
                const links = doc.querySelectorAll('a[href]');
                const userLinks = [];
                
                links.forEach(link => {
                    const href = link.getAttribute('href');
                    const text = link.textContent.toLowerCase();
                    
                    // æ£€æŸ¥é“¾æ¥æ˜¯å¦ç¬¦åˆç­›é€‰æ¡ä»¶
                    const matchesFilter = filters.some(filter => 
                        href.toLowerCase().includes(filter) || text.includes(filter)
                    );
                    
                    if (matchesFilter) {
                        const fullUrl = href.startsWith('http') ? href : new URL(href, url).href;
                        userLinks.push({
                            url: fullUrl,
                            text: link.textContent || 'æ— æ–‡æœ¬',
                            source: url
                        });
                    }
                });
                
                updateProgress(90);
                
                // å»é‡å¹¶é™åˆ¶æ•°é‡
                const uniqueLinks = Array.from(new Set(userLinks.map(l => l.url)))
                    .map(url => userLinks.find(l => l.url === url))
                    .slice(0, maxResults);
                
                collectedLinks = uniqueLinks;
                displayResults(uniqueLinks);
                updateProgress(100);
                
                showNotification(`æˆåŠŸæ‰¾åˆ° ${uniqueLinks.length} ä¸ªç”¨æˆ·é“¾æ¥`);
                
            } catch (error) {
                console.error('çˆ¬å–å¤±è´¥:', error);
                showNotification(`çˆ¬å–å¤±è´¥: ${error.message}`, true);
                // æ¼”ç¤ºæ¨¡å¼ï¼šæ˜¾ç¤ºç¤ºä¾‹æ•°æ®
                showDemoData();
            } finally {
                document.getElementById('loading').style.display = 'none';
                setTimeout(() => updateProgress(0), 1000);
            }
        }
        
        function displayResults(links) {
            const resultsContainer = document.getElementById('results');
            const countElement = document.getElementById('result-count');
            
            countElement.textContent = `æ‰¾åˆ° ${links.length} ä¸ªç”¨æˆ·é“¾æ¥`;
            
            if (links.length === 0) {
                resultsContainer.innerHTML = '<div class="result-item">æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç»“æœ</div>';
                document.getElementById('export-btn').disabled = true;
                return;
            }
            
            resultsContainer.innerHTML = links.map((link, index) => `
                <div class="result-item">
                    <div>
                        <strong>#${index + 1}</strong>: ${link.text}<br>
                        <small>${link.url}</small>
                    </div>
                    <a href="${link.url}" target="_blank" style="color: #667eea;">ğŸ”—</a>
                </div>
            `).join('');
            
            document.getElementById('export-btn').disabled = false;
        }
        
        function showDemoData() {
            // æ¼”ç¤ºæ•°æ®
            const demoLinks = [
                { url: 'https://github.com/user1', text: 'ç”¨æˆ·1 - Pythonå¼€å‘è€…', source: 'demo' },
                { url: 'https://github.com/user2', text: 'ç”¨æˆ·2 - Webå¼€å‘è€…', source: 'demo' },
                { url: 'https://github.com/user3', text: 'ç”¨æˆ·3 - æ•°æ®ç§‘å­¦å®¶', source: 'demo' },
                { url: 'https://github.com/user4', text: 'ç”¨æˆ·4 - AIå·¥ç¨‹å¸ˆ', source: 'demo' },
                { url: 'https://github.com/user5', text: 'ç”¨æˆ·5 - å…¨æ ˆå¼€å‘è€…', source: 'demo' },
            ];
            
            collectedLinks = demoLinks;
            displayResults(demoLinks);
            showNotification('æ˜¾ç¤ºæ¼”ç¤ºæ•°æ®ï¼ˆå®é™…çˆ¬å–å¤±è´¥ï¼‰', true);
        }
        
        function exportToExcel() {
            if (collectedLinks.length === 0) {
                showNotification('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º', true);
                return;
            }
            
            try {
                // å‡†å¤‡æ•°æ®
                const data = collectedLinks.map((link, index) => ({
                    'åºå·': index + 1,
                    'ç”¨æˆ·é“¾æ¥': link.url,
                    'é“¾æ¥æ–‡æœ¬': link.text,
                    'æ¥æºé¡µé¢': link.source,
                    'é‡‡é›†æ—¶é—´': new Date().toLocaleString()
                }));
                
                // åˆ›å»ºå·¥ä½œç°¿
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(data);
                
                // è®¾ç½®åˆ—å®½
                const wscols = [
                    { wch: 8 },  // åºå·
                    { wch: 40 }, // ç”¨æˆ·é“¾æ¥
                    { wch: 30 }, // é“¾æ¥æ–‡æœ¬
                    { wch: 30 }, // æ¥æºé¡µé¢
                    { wch: 20 }  // é‡‡é›†æ—¶é—´
                ];
                ws['!cols'] = wscols;
                
                XLSX.utils.book_append_sheet(wb, ws, 'ç”¨æˆ·é“¾æ¥');
                
                // ç”Ÿæˆæ–‡ä»¶å
                const filename = `user_links_${new Date().getTime()}.xlsx`;
                
                // å¯¼å‡ºæ–‡ä»¶
                XLSX.writeFile(wb, filename);
                
                showNotification(`æˆåŠŸå¯¼å‡º ${collectedLinks.length} æ¡æ•°æ®åˆ° ${filename}`);
                
            } catch (error) {
                console.error('å¯¼å‡ºå¤±è´¥:', error);
                showNotification('å¯¼å‡ºå¤±è´¥: ' + error.message, true);
            }
        }
        
        // åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
        window.onload = showDemoData;
    </script>
</body>
</html>
